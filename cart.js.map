{"version":3,"file":"cart.js","sources":["../src/cart.js"],"sourcesContent":["import { fetchProductsById } from \"./js/products-api\";\nimport { renderProducts, renderProductInModal } from \"./js/render-function\";\nimport { productsList, notFoundDiv, modal, cartButton, navCountCart, cartCount, cartPrice, cartSummaryButton, navCount } from \"./js/constants\";\nimport { getCart, addToCart, removeFromCart, isInCart, getWishlist } from \"./js/storage\";\nimport iziToast from \"izitoast\";\nimport { changeTheme } from \"./js/helpers\";\n\n// Оновлюємо лічильник в навігації для Wishlist\nconst updateNavCount = () => {\n  const wishlist = getWishlist();\n  navCount.textContent = wishlist.length;\n};\n\n// Оновлюємо лічильник в навігації для Cart\nconst updateNavCountCart = () => {\n  const cart = getCart();\n  const totalCount = cart.reduce((sum, item) => sum + item.quantity, 0);\n  navCountCart.textContent = totalCount;\n};\n\n// Оновлення тексту кнопки Cart у модальному вікні\nconst updateCartButton = (productId) => {\n  if (isInCart(productId)) {\n    cartButton.textContent = 'Remove from Cart';\n  } else {\n    cartButton.textContent = 'Add to Cart';\n  }\n};\n\n// Оновлення підсумку по кількості товарів та ціні у кошику\nconst updatecartSummary = async () => {\n  const cart = getCart();\n\n  if (cart.length === 0) {\n    cartCount.textContent = \"0\";\n    cartPrice.textContent = \"$0.00\";\n    return;\n  }\n\n  const validCartItems = cart.filter(item => typeof item.id !== 'undefined');\n\n  if (validCartItems.length === 0) {\n    cartCount.textContent = \"0\";\n    cartPrice.textContent = \"$0.00\";\n    return;\n  }\n\n  try {\n    const products = await Promise.all(validCartItems.map(item => fetchProductsById(item.id)));\n    const totalCount = validCartItems.reduce((sum, item) => sum + item.quantity, 0);\n    cartCount.textContent = totalCount;\n\n    const totalPrice = products.reduce((sum, product) => {\n      const item = validCartItems.find(i => i.id === product.id);\n      return sum + product.price * (item ? item.quantity : 1);\n    }, 0);\n    cartPrice.textContent = `$${totalPrice.toFixed(2)}`;\n  } catch (error) {\n    console.error('Помилка при оновленні підсумку кошика:', error);\n    cartCount.textContent = \"0\";\n    cartPrice.textContent = \"$0.00\";\n  }\n};\n\n// Завантаження та відображення товарів з кошика\nconst loadCartProducts = async () => {\n  const cart = getCart();\n\n  if (cart.length === 0) {\n    notFoundDiv.classList.add('not-found--visible');\n    productsList.innerHTML = '';\n    return;\n  }\n\n  // Фільтруємо тільки валідні id\n  const validCartItems = cart.filter(item => typeof item.id !== 'undefined');\n\n  if (validCartItems.length === 0) {\n    notFoundDiv.classList.add('not-found--visible');\n    productsList.innerHTML = '';\n    return;\n  }\n\n  try {\n    const products = await Promise.all(validCartItems.map(item => fetchProductsById(item.id)));\n    const productsWithQuantity = products.map(product => {\n      const cartItem = validCartItems.find(i => i.id === product.id);\n      return { ...product, quantity: cartItem ? cartItem.quantity : 1 };\n    });\n\n    notFoundDiv.classList.remove('not-found--visible');\n    renderProducts(productsWithQuantity);\n\n    const quantityElements = document.querySelectorAll(\".product-quantity-product\");\n    quantityElements.forEach(el => el.classList.remove(\"hidden\"));\n  } catch (error) {\n    console.error('Помилка при завантаженні продуктів кошика:', error);\n    notFoundDiv.classList.add('not-found--visible');\n    productsList.innerHTML = '';\n  }\n};\n\n\n// Обробник кліку по товару — відкриває модалку\nproductsList.addEventListener(\"click\", async (event) => {\n    const target = event.target;\n\n    if (target.classList.contains('quantity-button')) {\n    return; // Просто виходимо з обробника\n  }\n\n  const productItem = target.closest(\"li.products__item\");\n  if (!productItem) return;\n\n  const productId = Number(productItem.dataset.id);\n  if (!productId) return;\n\n  try {\n    const product = await fetchProductsById(productId);\n    renderProductInModal(product);\n    modal.classList.add(\"modal--is-open\");\n\n    updateCartButton(productId);\n\n    cartButton.onclick = async () => {\n      if (isInCart(productId)) {\n        removeFromCart(productId);\n      } else {\n        addToCart(productId);\n      }\n      updateCartButton(productId);\n      updateNavCountCart();\n      await loadCartProducts();\n      await updatecartSummary();\n    };\n  } catch (error) {\n    console.error('Помилка при завантаженні продукту:', error);\n  }\n});\n\n// Кнопка оформлення покупки\ncartSummaryButton.addEventListener('click', async () => {\n  const cart = getCart();\n\n  if (cart.length === 0) {\n    iziToast.warning({\n      title: 'Oops!',\n      message: 'Your cart is empty!',\n      position: \"topLeft\"\n    });\n    return;\n  }\n\n  iziToast.success({\n    title: 'Success!',\n    message: 'Products purchased successfully!',\n    position: \"topLeft\"\n  });\n\n  localStorage.removeItem('cart'); // Очищуємо корзину\n  await loadCartProducts();\n  updateNavCountCart();\n  await updatecartSummary();\n});\n\n// Закриття модалки\nmodal.addEventListener(\"click\", (event) => {\n  if (event.target === modal || event.target.classList.contains(\"modal__close-btn\")) {\n    modal.classList.remove(\"modal--is-open\");\n  }\n});\n\n// Початкове завантаження сторінки\ndocument.addEventListener('DOMContentLoaded', () => {\n  loadCartProducts();\n  updateNavCountCart();\n  updateNavCount();\n  updatecartSummary();\n  changeTheme();\n});"],"names":["updateNavCount","wishlist","getWishlist","navCount","updateNavCountCart","totalCount","getCart","sum","item","navCountCart","updateCartButton","productId","isInCart","cartButton","updatecartSummary","cart","cartCount","cartPrice","validCartItems","products","fetchProductsById","totalPrice","product","i","error","loadCartProducts","notFoundDiv","productsList","productsWithQuantity","cartItem","renderProducts","el","event","target","productItem","renderProductInModal","modal","removeFromCart","addToCart","cartSummaryButton","iziToast","changeTheme"],"mappings":"mNAQA,MAAMA,EAAiB,IAAM,CAC3B,MAAMC,EAAWC,IACjBC,EAAS,YAAcF,EAAS,MAClC,EAGMG,EAAqB,IAAM,CAE/B,MAAMC,EADOC,IACW,OAAO,CAACC,EAAKC,IAASD,EAAMC,EAAK,SAAU,CAAC,EACpEC,EAAa,YAAcJ,CAC7B,EAGMK,EAAoBC,GAAc,CAClCC,EAASD,CAAS,EACpBE,EAAW,YAAc,mBAEzBA,EAAW,YAAc,aAE7B,EAGMC,EAAoB,SAAY,CACpC,MAAMC,EAAOT,IAEb,GAAIS,EAAK,SAAW,EAAG,CACrBC,EAAU,YAAc,IACxBC,EAAU,YAAc,QACxB,MACD,CAED,MAAMC,EAAiBH,EAAK,OAAOP,GAAQ,OAAOA,EAAK,GAAO,GAAW,EAEzE,GAAIU,EAAe,SAAW,EAAG,CAC/BF,EAAU,YAAc,IACxBC,EAAU,YAAc,QACxB,MACD,CAED,GAAI,CACF,MAAME,EAAW,MAAM,QAAQ,IAAID,EAAe,IAAIV,GAAQY,EAAkBZ,EAAK,EAAE,CAAC,CAAC,EACnFH,EAAaa,EAAe,OAAO,CAACX,EAAKC,IAASD,EAAMC,EAAK,SAAU,CAAC,EAC9EQ,EAAU,YAAcX,EAExB,MAAMgB,EAAaF,EAAS,OAAO,CAACZ,EAAKe,IAAY,CACnD,MAAMd,EAAOU,EAAe,KAAKK,GAAKA,EAAE,KAAOD,EAAQ,EAAE,EACzD,OAAOf,EAAMe,EAAQ,OAASd,EAAOA,EAAK,SAAW,EACtD,EAAE,CAAC,EACJS,EAAU,YAAc,IAAII,EAAW,QAAQ,CAAC,CAAC,EAClD,OAAQG,EAAO,CACd,QAAQ,MAAM,yCAA0CA,CAAK,EAC7DR,EAAU,YAAc,IACxBC,EAAU,YAAc,OACzB,CACH,EAGMQ,EAAmB,SAAY,CACnC,MAAMV,EAAOT,IAEb,GAAIS,EAAK,SAAW,EAAG,CACrBW,EAAY,UAAU,IAAI,oBAAoB,EAC9CC,EAAa,UAAY,GACzB,MACD,CAGD,MAAMT,EAAiBH,EAAK,OAAOP,GAAQ,OAAOA,EAAK,GAAO,GAAW,EAEzE,GAAIU,EAAe,SAAW,EAAG,CAC/BQ,EAAY,UAAU,IAAI,oBAAoB,EAC9CC,EAAa,UAAY,GACzB,MACD,CAED,GAAI,CAEF,MAAMC,GADW,MAAM,QAAQ,IAAIV,EAAe,IAAIV,GAAQY,EAAkBZ,EAAK,EAAE,CAAC,CAAC,GACnD,IAAIc,GAAW,CACnD,MAAMO,EAAWX,EAAe,KAAKK,GAAKA,EAAE,KAAOD,EAAQ,EAAE,EAC7D,MAAO,CAAE,GAAGA,EAAS,SAAUO,EAAWA,EAAS,SAAW,EACpE,CAAK,EAEDH,EAAY,UAAU,OAAO,oBAAoB,EACjDI,EAAeF,CAAoB,EAEV,SAAS,iBAAiB,2BAA2B,EAC7D,QAAQG,GAAMA,EAAG,UAAU,OAAO,QAAQ,CAAC,CAC7D,OAAQP,EAAO,CACd,QAAQ,MAAM,6CAA8CA,CAAK,EACjEE,EAAY,UAAU,IAAI,oBAAoB,EAC9CC,EAAa,UAAY,EAC1B,CACH,EAIAA,EAAa,iBAAiB,QAAS,MAAOK,GAAU,CACpD,MAAMC,EAASD,EAAM,OAErB,GAAIC,EAAO,UAAU,SAAS,iBAAiB,EAC/C,OAGF,MAAMC,EAAcD,EAAO,QAAQ,mBAAmB,EACtD,GAAI,CAACC,EAAa,OAElB,MAAMvB,EAAY,OAAOuB,EAAY,QAAQ,EAAE,EAC/C,GAAKvB,EAEL,GAAI,CACF,MAAMW,EAAU,MAAMF,EAAkBT,CAAS,EACjDwB,EAAqBb,CAAO,EAC5Bc,EAAM,UAAU,IAAI,gBAAgB,EAEpC1B,EAAiBC,CAAS,EAE1BE,EAAW,QAAU,SAAY,CAC3BD,EAASD,CAAS,EACpB0B,EAAe1B,CAAS,EAExB2B,EAAU3B,CAAS,EAErBD,EAAiBC,CAAS,EAC1BP,IACA,MAAMqB,EAAgB,EACtB,MAAMX,EAAiB,CAC7B,CACG,OAAQU,EAAO,CACd,QAAQ,MAAM,qCAAsCA,CAAK,CAC1D,CACH,CAAC,EAGDe,EAAkB,iBAAiB,QAAS,SAAY,CAGtD,GAFajC,IAEJ,SAAW,EAAG,CACrBkC,EAAS,QAAQ,CACf,MAAO,QACP,QAAS,sBACT,SAAU,SAChB,CAAK,EACD,MACD,CAEDA,EAAS,QAAQ,CACf,MAAO,WACP,QAAS,mCACT,SAAU,SACd,CAAG,EAED,aAAa,WAAW,MAAM,EAC9B,MAAMf,EAAgB,EACtBrB,IACA,MAAMU,EAAiB,CACzB,CAAC,EAGDsB,EAAM,iBAAiB,QAAUJ,GAAU,EACrCA,EAAM,SAAWI,GAASJ,EAAM,OAAO,UAAU,SAAS,kBAAkB,IAC9EI,EAAM,UAAU,OAAO,gBAAgB,CAE3C,CAAC,EAGD,SAAS,iBAAiB,mBAAoB,IAAM,CAClDX,IACArB,IACAJ,IACAc,IACA2B,GACF,CAAC"}