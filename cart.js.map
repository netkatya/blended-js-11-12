{"version":3,"file":"cart.js","sources":["../src/cart.js"],"sourcesContent":["import { fetchProductsById } from \"./js/products-api\";\nimport { renderProducts, renderProductInModal } from \"./js/render-function\";\nimport { productsList, notFoundDiv, modal, cartButton, navCountCart, cartCount, cartPrice, cartSummaryButton, navCount } from \"./js/constants\";\nimport { getCart, addToCart, removeFromCart, isInCart, getWishlist, saveCart } from \"./js/storage\";\nimport iziToast from \"izitoast\";\nimport { changeTheme } from \"./js/helpers\";\n\n// Оновлюємо лічильник в навігації для Wishlist\nconst updateNavCount = () => {\n  const wishlist = getWishlist();\n  navCount.textContent = wishlist.length;\n};\n\n// Оновлюємо лічильник в навігації для Cart\nconst updateNavCountCart = () => {\n  const cart = getCart();\n  const totalCount = cart.reduce((sum, item) => sum + item.quantity, 0);\n  navCountCart.textContent = totalCount;\n};\n\n// Оновлення тексту кнопки Cart у модальному вікні\nconst updateCartButton = (productId) => {\n  if (isInCart(productId)) {\n    cartButton.textContent = 'Remove from Cart';\n  } else {\n    cartButton.textContent = 'Add to Cart';\n  }\n};\n\n// Оновлення підсумку по кількості товарів та ціні у кошику\nconst updatecartSummary = async () => {\n  const cart = getCart();\n\n  if (cart.length === 0) {\n    cartCount.textContent = \"0\";\n    cartPrice.textContent = \"$0.00\";\n    return;\n  }\n\n  const validCartItems = cart.filter(item => typeof item.id !== 'undefined');\n\n  if (validCartItems.length === 0) {\n    cartCount.textContent = \"0\";\n    cartPrice.textContent = \"$0.00\";\n    return;\n  }\n\n  try {\n    const products = await Promise.all(validCartItems.map(item => fetchProductsById(item.id)));\n    const totalCount = validCartItems.reduce((sum, item) => sum + item.quantity, 0);\n    cartCount.textContent = totalCount;\n\n    const totalPrice = products.reduce((sum, product) => {\n      const matchingItems = validCartItems.filter(i => i.id === product.id);\n      const quantity = matchingItems.reduce((qSum, i) => qSum + i.quantity, 0);\n      return sum + product.price * quantity;\n    }, 0);\n    cartPrice.textContent = `$${totalPrice.toFixed(2)}`;\n  } catch (error) {\n    console.error('Помилка при оновленні підсумку кошика:', error);\n    cartCount.textContent = \"0\";\n    cartPrice.textContent = \"$0.00\";\n  }\n};\n\n// Завантаження та відображення товарів з кошика\nconst loadCartProducts = async () => {\n  const cart = getCart();\n\n  if (cart.length === 0) {\n    notFoundDiv.classList.add('not-found--visible');\n    productsList.innerHTML = '';\n    return;\n  }\n\n  // filtre valid id\n  const validCartItems = cart.filter(item => typeof item.id !== 'undefined');\n\n  if (validCartItems.length === 0) {\n    notFoundDiv.classList.add('not-found--visible');\n    productsList.innerHTML = '';\n    return;\n  }\n\n  try {\n    const products = await Promise.all(validCartItems.map(item => fetchProductsById(item.id)));\n    const productsWithQuantity = products.map(product => {\n      const cartItem = validCartItems.find(i => i.id === product.id);\n      return { ...product, quantity: cartItem ? cartItem.quantity : 1 };\n    });\n\n    notFoundDiv.classList.remove('not-found--visible');\n    renderProducts(productsWithQuantity);\n\n    const quantityElements = document.querySelectorAll(\".product-quantity-product\");\n    quantityElements.forEach(el => el.classList.remove(\"hidden\"));\n  } catch (error) {\n    console.error('Помилка при завантаженні продуктів кошика:', error);\n    notFoundDiv.classList.add('not-found--visible');\n    productsList.innerHTML = '';\n  }\n};\n\n\n// open modal\nproductsList.addEventListener(\"click\", async (event) => {\n    const target = event.target;\n\n    if (target.classList.contains('quantity-button')) {\n    return; // Просто виходимо з обробника\n  }\n\n  const productItem = target.closest(\"li.products__item\");\n  if (!productItem) return;\n\n  const productId = Number(productItem.dataset.id);\n  if (!productId) return;\n\n  try {\n    const product = await fetchProductsById(productId);\n    renderProductInModal(product);\n    modal.classList.add(\"modal--is-open\");\n\n    updateCartButton(productId);\n\n    cartButton.onclick = async () => {\n      if (isInCart(productId)) {\n        removeFromCart(productId);\n      } else {\n        addToCart(productId);\n      }\n      updateCartButton(productId);\n      updateNavCountCart();\n      await loadCartProducts();\n      await updatecartSummary();\n    };\n  } catch (error) {\n    console.error('Помилка при завантаженні продукту:', error);\n  }\n});\n\n// buy button\ncartSummaryButton.addEventListener('click', async () => {\n  const cart = getCart();\n\n  if (cart.length === 0) {\n    iziToast.warning({\n      title: 'Oops!',\n      message: 'Your cart is empty!',\n      position: \"topLeft\"\n    });\n    return;\n  }\n\n  iziToast.success({\n    title: 'Success!',\n    message: 'Products purchased successfully!',\n    position: \"topLeft\"\n  });\n\n  localStorage.removeItem('cart'); // Очищуємо корзину\n  await loadCartProducts();\n  updateNavCountCart();\n  await updatecartSummary();\n});\n\n// close modal\nmodal.addEventListener(\"click\", (event) => {\n  if (event.target === modal || event.target.classList.contains(\"modal__close-btn\")) {\n    modal.classList.remove(\"modal--is-open\");\n  }\n});\n\n// first load page\ndocument.addEventListener('DOMContentLoaded', () => {\n  loadCartProducts();\n  updateNavCountCart();\n  updateNavCount();\n  updatecartSummary();\n  changeTheme();\n});\n\ndocument.addEventListener(\"click\", async (event) => {\n  const plusBtn = event.target.closest(\".plus-button\");\n  const minusBtn = event.target.closest(\".minus-button\");\n\n  if (plusBtn || minusBtn) {\n    const productDiv = event.target.closest(\".product\");\n\n    if (!productDiv) return;\n\n    const productId = productDiv.dataset.id;\n    if (!productId) return;\n\nconst input = productDiv.querySelector(\".quantity-input\");\nif (!input) return;\n\nlet quantity = parseInt(input.value, 10) || 0;\n\nif (plusBtn) {\n  quantity += 1;\n} else if (minusBtn && quantity > 0) {\n  quantity -= 1;\n}\n\ninput.value = quantity;\n\n    if (quantity > 0) {\n      updateCartItem(productId, quantity);\n    } else {\n      removeFromCart(productId);\n     \n    }\n\n    // Refresh cart after quantity change\n    \n    await updatecartSummary();\n    updateNavCountCart();\n  }\n});\n\nexport const updateCartItem = (productId, quantity) => {\n  const id = Number(productId); // ⬅ Normalize to number\n  let cart = getCart();\n  const itemIndex = cart.findIndex(p => Number(p.id) === id);\n\n  if (itemIndex !== -1) {\n    if (quantity > 0) {\n      cart[itemIndex].quantity = quantity;\n    } else {\n      cart.splice(itemIndex, 1);\n    }\n  } else if (quantity > 0) {\n    cart.push({ id, quantity });\n  }\n\n  saveCart(cart);\n};"],"names":["updateNavCount","wishlist","getWishlist","navCount","updateNavCountCart","totalCount","getCart","sum","item","navCountCart","updateCartButton","productId","isInCart","cartButton","updatecartSummary","cart","cartCount","cartPrice","validCartItems","products","fetchProductsById","totalPrice","product","quantity","i","qSum","error","loadCartProducts","notFoundDiv","productsList","productsWithQuantity","cartItem","renderProducts","el","event","target","productItem","renderProductInModal","modal","removeFromCart","addToCart","cartSummaryButton","iziToast","changeTheme","plusBtn","minusBtn","productDiv","input","updateCartItem","id","itemIndex","p","saveCart"],"mappings":"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"}